!function(e,t){if("function"==typeof define&&define.amd)define(["tappy-tcmp","ndef","tappy-systemfamily","tappy-basicnfcfamily"],t);else if("object"==typeof exports){var s=null;try{s=require("@taptrack/tappy")}catch(r){s=require("tappy")}var o=null;try{o=require("@taptrack/ndef")}catch(r){o=require("ndef")}var a=null;try{a=require("@taptrack/tappy-systemfamily")}catch(r){a=require("tappy-systemfamily")}var n=null;try{n=require("@taptrack/tappy-basicnfcfamily")}catch(r){n=require("tappy-basicnfcfamily")}module.exports=t(s,o,a,n)}else e.TappyWrapper=t(e.Tappy,e.Ndef,e.TappySystemFamily,e.TappyBasicNfcFamily)}(this,function(e,t,s,r){var o=function(e){for(var t="",s=0;s<e.length;s++){var r=e[s].toString(16).toUpperCase();t=e[s]<=15?t.concat("0"+r):t.concat(r)}return t},a=function(){this.subscribers={}};a.prototype.publish=function(e){var t=this;if("undefined"==typeof e)throw new Error("Must specify a message to publish");if(arguments.length<=1)throw new Error("Must specify one message and one or more topics");for(var s=1;s<arguments.length;s++){if("string"!=typeof arguments[s])throw new Error("Invalid argument specified, must be a string topic");"function"==typeof t.subscribers[arguments[s]]&&t.subscribers[arguments[s]](e)}},a.prototype.setSubscriber=function(e,t){var s=this;if("function"!=typeof t)throw new Error("Subscriber must be a function");if("string"!=typeof e)throw new Error("Must subscribe to a string subject");s.subscribers[e]=t};var n=function(e){this.resolvers=e};n.prototype.checkFamily=function(e){for(var t=this,s=!1,r=0;r<t.resolvers.length;r++)s=s||t.resolvers[r].checkFamily(e);return s},n.prototype.resolveCommand=function(e){for(var t=this,s=0;s<t.resolvers.length;s++){var r=t.resolvers[s];if(r.checkFamily(e))return r.resolveCommand(e)}throw new Error("Unsupported command type")},n.prototype.resolveResponse=function(e){for(var t=this,s=0;s<t.resolvers.length;s++){var r=t.resolvers[s];if(r.checkFamily(e))return r.resolveResponse(e)}throw new Error("Unsupported response type")};var i=function(i){var p=this;"object"==typeof i.tappy&&null!==i.tappy?p.tappy=i.tappy:p.tappy=new e(i),p.eb=new a;var g=new n([new r.Resolver,new s.Resolver]);tappy.setMessageListener(function(a){if(p.eb.publish({message:a},"received"),g.checkFamily(a)){var n=null;try{n=p.resolver.resolveResponse(a)}catch(i){p.eb.publish({message:a},"invalid_message")}if(null===n)return;var c=r.Responses,y=s.Responses;if(c.TagFound.isTypeOf(n))p.eb.publish({message:a,resolved:n,tagTypeCode:a.getTagCode(),tagType:e.resolveTagType(a.getTagType()),tagCode:a.getTagCode(),tagCodeStr:o(a.getTagCode())},"tag_found");else if(c.TagWritten.isTypeOf(n))p.eb.publish({message:a,resolved:n,tagTypeCode:a.getTagType(),tagType:e.resolveTagType(a.getTagType()),tagCode:a.getTagCode(),tagCodeStr:o(a.getTagCode())},"tag_written");else if(c.NdefFound.isTypeOf(n)){var f=a.getMessage(),l=null;try{l=t.Message.fromBytes(f)}catch(i){return void p.eb.publish({message:a,resolved:n,tagTypeCode:a.getTagType(),tagType:e.resolveTagType(a.getTagType()),tagCode:a.getTagCode(),tagCodeStr:o(a.getTagCode()),rawNdef:f,error:i},"invalid_ndef")}p.eb.publish({message:a,resolved:n,tagTypeCode:a.getTagType(),tagType:e.resolveTagType(a.getTagType()),tagCode:a.getTagCode(),tagCodeStr:o(a.getTagCode()),rawNdef:f,ndef:l},"ndef_found")}else c.TagLocked.isTypeOf(n)?p.eb.publish({message:a,resolved:n,tagTypeCode:a.getTagType(),tagType:e.resolveTagType(a.getTagType()),tagCode:a.getTagCode(),tagCodeStr:o(a.getTagCode())},"tag_written"):c.ApplicationError.isTypeOf(n)?p.eb.publish({message:a,resolved:n,description:n.getErrorMessage()},"error_message"):y.LcsMismatch.isTypeOf(n)?p.eb.publish({message:a,resolved:n,description:"LCS Mismatch"},"error_message"):y.LengthMismatch.isTypeOf(n)?p.eb.publish({message:a,resolved:n,description:"Message length mismatch"},"error_message"):y.ImproperMessageFormat.isTypeOf(n)?p.eb.publish({message:a,resolved:n,description:"Improper message format"},"error_message"):y.CrcMismatch.isTypeOf(n)?p.eb.publish({message:a,resolved:n,description:"CRC mismatch"},"error_message"):y.SystemError.isTypeOf(n)&&p.eb.publish({message:a,resolved:n,description:n.getErrorMessage()},"error_message")}}),tappy.setErrorListener(function(e){})};return i.prototype.isConnected=function(){var e=this;return e.tappy.isConnected()},i.prototype.connect=function(e){var t=this;return t.tappy.connect(function(){"function"==typeof e&&e.apply(this,arguments),t.eb.publish({args:arguments},"connect")})},i.prototype.disconnect=function(e){var t=this;return t.tappy.disconnect(function(){"function"==typeof e&&e.apply(this,arguments),t.eb.publish({args:arguments},"disconnect")})},i.prototype.sendMessage=function(e){var t=this;t.tappy.sendMessage(e),t.eb.publish({message:e},"sent")},i.prototype.detectTag=function(e){var t=this;e="boolean"==typeof e&&e;var s=null;s=e?new r.Commands.StreamTags(0,r.PollingModes.GENERAL):new r.Commands.ScanTag(0,r.PollingModes.GENERAL),t.sendMessage(s)},i.prototype.scanNdef=function(e){var t=this;e="boolean"==typeof e&&e;var s=null;s=e?new r.Commands.StreamNdef(0,r.PollingModes.GENERAL):new r.Commands.ScanNdef(0,r.PollingModes.GENERAL),t.sendMessage(s)},i.prototype.writeUrl=function(){var e=this;e.writeUri.apply(e,arguments)},i.prototype.writeUri=function(e,s){e="string"==typeof e?e:"",s="boolean"==typeof s&&s;var r=t.Utils.resolveUriToPrefix(e);new BasicNfc.Commands.WriteNdefUri(0,s,r.content,r.prefixCode)},i.prototype.writeText=function(e,t){var s=this;e="string"==typeof e?e:"",t="boolean"==typeof t&&t,msg=new r.Commands.WriteNdefText(0,t,e),s.sendMessage(msg)},i.prototype.writeNdef=function(e,t){var s=this;t="boolean"==typeof t&&t;var o=new r.Commands.WriteCustomNdef(0,t,e);s.sendMessage(o)},i.prototype.lockTag=function(e){var t=this;e=e||null;var s=new r.Commands.LockTag(0,e);t.sendMessage(s)},i.prototype.stop=function(){var e=this,t=new r.Commands.Stop;e.sendMessage(t)},i.prototype.on=function(e,t){var s=this;s.eb.setSubscriber(e,t)},i});